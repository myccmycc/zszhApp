<?xml version="1.0" encoding="utf-8"?>
<s:SkinnableContainer xmlns:fx="http://ns.adobe.com/mxml/2009" 
					  xmlns:s="library://ns.adobe.com/flex/spark" 
					  xmlns:mx="library://ns.adobe.com/flex/mx" width="642" height="46" initialize="skinnablecontainer_initializeHandler(event)">
	<fx:Declarations>
		<!-- Place non-visual elements (e.g., services, value objects) here -->
	</fx:Declarations>
	<fx:Script>
	<![CDATA[
		import mx.core.UIComponent;
		import mx.events.FlexEvent;
		
		import away3d.containers.ObjectContainer3D;
		
		import zszh_WorkSpace2D.Object2D_Model;
		import zszh_WorkSpace2D.Object2D_PartitionWall;
		import zszh_WorkSpace2D.Object2D_Room;
		
		import zszh_WorkSpace3D.Model_3D;
		[Embed(source="embeds/ToolsBar/toolbar_1.png")]
		public var Button1_down:Class;
		[Embed(source="embeds/ToolsBar/toolbar_2.png")]
		public var Button2_down:Class;
		[Embed(source="embeds/ToolsBar/toolbar_3.png")]
		public var Button3_down:Class;
		[Embed(source="embeds/ToolsBar/toolbar_4.png")]
		public var Button4_down:Class;
		[Embed(source="embeds/ToolsBar/toolbar_5.png")]
		public var Button5_down:Class;
		[Embed(source="embeds/ToolsBar/toolbar_6.png")]
		public var Button6_down:Class;
		[Embed(source="embeds/ToolsBar/toolbar_7.png")]
		public var Button7_down:Class;
		[Embed(source="embeds/ToolsBar/toolbar_8.png")]
		public var Button8_down:Class;
		[Embed(source="embeds/ToolsBar/toolbar_9.png")]
		public var Button9_down:Class;
		[Embed(source="embeds/ToolsBar/toolbar_10.png")]
		public var Button10_down:Class;
		[Embed(source="embeds/ToolsBar/toolbar_11.png")]
		public var Button11_down:Class;

		protected function skinnablecontainer_initializeHandler(event:FlexEvent):void
		{
			// TODO Auto-generated method stub
			
		}
		
		protected function SaveToXML(event:MouseEvent):void
		{
			parentApplication.WorkSpace2D.WorkSpace2D.SaveToXML("SaveTest.xml");
		}
		protected function ShowWorkspace2D(event:MouseEvent):void
		{
			//updata 2d model position
			var _models3D:ObjectContainer3D=parentApplication.WorkSpace3D._modelsContainer3D;
			for(var i:int=0;i<_models3D.numChildren;i++)
			{
				var model3d:Model_3D = _models3D.getChildAt(i) as Model_3D;

				var _models2DVec:Vector.<Object2D_Model>=parentApplication.WorkSpace2D.WorkSpace2D._modelsVec;
				
				for(var i:int=0;i<_models2DVec.length;i++)
				{
					var model2d:Object2D_Model=_models2DVec[i];	
					
					if(model2d.name==model3d.name )
					{
						model2d.x=model3d.x+3200;
						model2d.y=3200-model3d.z;  
						break;
					}
				}
			}	
				
			parentApplication.WorkspaceBack.visible=true;
			parentApplication.WorkSpace3D.visible=false;
			parentApplication.WorkSpace2D.visible=true;
		}
		
		protected function ShowWorkspace3D(event:MouseEvent):void
		{
			parentApplication.WorkspaceBack.visible=false;
				parentApplication.WorkSpace3D.ClearRoom();
			
			for(var i:int=0;i<parentApplication.WorkSpace2D.WorkSpace2D._grid.numChildren;i++)
			{
				var obj:DisplayObject=parentApplication.WorkSpace2D.WorkSpace2D._grid.getChildAt(i);
				
				if(obj is Object2D_Room)
					
				{
					var room2d:Object2D_Room= obj as Object2D_Room;		
					var vertex_old:Vector.<Number>= (room2d as Object2D_Room)._vertexVec1;
				
					var vertex_old2:Vector.<Number>= (room2d as Object2D_Room)._vertexVec2;
					var vertex_old3:Vector.<Number>= (room2d as Object2D_Room)._vertexVec3;
				
					var vertex_new:Vector.<Number>=new Vector.<Number>;
					var vertex_new2:Vector.<Number>=new Vector.<Number>;
					var vertex_new3:Vector.<Number>=new Vector.<Number>;
					
					if(room2d.className=="Object2D_Room"&&room2d.visible)
					{
						for(var j:int=0;j<vertex_old.length;j+=2)
						{
							vertex_new.push(room2d.x+vertex_old[j]-3200);
							vertex_new.push(-room2d.y+vertex_old[j+1]+3200);
						
							vertex_new2.push(room2d.x+vertex_old2[j]-3200);
							vertex_new2.push(-room2d.y+vertex_old2[j+1]+3200);
						
							vertex_new3.push(room2d.x+vertex_old3[j]-3200);
							vertex_new3.push(-room2d.y+vertex_old3[j+1]+3200);
						}
						parentApplication.WorkSpace3D.AddRoom(vertex_new,vertex_new2,vertex_new3,room2d._floor._floorTex, room2d.name);				    
					}
				}
			}
			//隔墙 
		parentApplication.WorkSpace3D.ClearWallInside();
			
			for(var i:int=0;i<parentApplication.WorkSpace2D.WorkSpace2D._wall2DVec.length;i++)
			{
				var wallInside:UIComponent=parentApplication.WorkSpace2D.WorkSpace2D._wall2DVec[i] as UIComponent;					
				if(wallInside.className=="Wall_2D")
				{
					var pos:Array=new Array;
					var vertex_old:Vector.<Number>= (wallInside as Object2D_PartitionWall)._vertexVec;
					var vertex_new:Vector.<Number>=new Vector.<Number>;
					
					for(var j:int=0;j<vertex_old.length;j+=2)
					{
						vertex_new.push(wallInside.x+vertex_old[j]-3200);
						vertex_new.push(-wallInside.y-vertex_old[j+1]+3200);
					}
					parentApplication.WorkSpace3D.AddWallInside(vertex_new,wallInside.name);	 
				}
				
				
			}
						
			//模型创建
			parentApplication.WorkSpace3D.ClearModels();
			for(var i:int=0;i<parentApplication.WorkSpace2D.WorkSpace2D._modelsVec.length;i++)
			{
				var modelBed:UIComponent=parentApplication.WorkSpace2D.WorkSpace2D._modelsVec[i] as UIComponent;					
				if(modelBed.className=="Object2D_Model")
				{
					var mbed:Object2D_Model = modelBed as Object2D_Model;
					var mPos:Vector3D=new Vector3D();
					mPos.x=mbed.x+mbed.width/2-3200;
					mPos.y=0;
					mPos.z=-mbed.y-mbed.height/2+3200;
					parentApplication.WorkSpace3D.AddModels(mbed._resourcePath,mbed._modelName,mPos,mbed.name);    
				}
			}
			
			parentApplication.WorkSpace3D.visible=true;
			parentApplication.WorkSpace2D.WorkSpace2D.SetAllNoSelected();
			parentApplication.WorkSpace2D.WorkSpace2D.GetBounds();
			parentApplication.WorkSpace3D._cameraCenter.x=(parentApplication.WorkSpace2D.WorkSpace2D._xMax-parentApplication.WorkSpace2D.WorkSpace2D._xMin)/2+parentApplication.WorkSpace2D.WorkSpace2D._xMin-3200;
			parentApplication.WorkSpace3D._cameraCenter.z=-(parentApplication.WorkSpace2D.WorkSpace2D._yMax-parentApplication.WorkSpace2D.WorkSpace2D._yMin)/2-parentApplication.WorkSpace2D.WorkSpace2D._yMin+3200;
				
				
			parentApplication.WorkSpace2D.visible=false;
			
		}
		
		protected function ShowCenter(event:MouseEvent):void
		{
			parentApplication.WorkSpace2D.WorkSpace2D.ShowCenter();
		}
		
		import zszh_Core.CommandManager;
		private function UnDo(event:MouseEvent):void
		{
			CommandManager.Instance.Undo();
		}
		
		private function ReDo(event:MouseEvent):void
		{
			CommandManager.Instance.Redo();
		}
	]]>
	</fx:Script>
	
	<s:Image source="@Embed('embeds/ToolsBar/toolBar_Bg.png')"  />
	<s:Button id="Button1" name="Button1" x="35" verticalCenter="0" width="25" height="25" skinClass="zszh_ToolsBar.Skin_ToolsBarBt" icon="{Button1_down}" buttonMode="true" click="UnDo(event)" />
	<s:Button id="Button2" name="Button2" x="70" verticalCenter="0" width="25" height="25" skinClass="zszh_ToolsBar.Skin_ToolsBarBt" icon="{Button2_down}" buttonMode="true" click="ReDo(event)" />
	
	<s:Button id="Button3" name="Button3" x="125" verticalCenter="0" width="25" height="25" skinClass="zszh_ToolsBar.Skin_ToolsBarBt" icon="{Button3_down}" buttonMode="true" click="SaveToXML(event)"/>
	<s:Button id="Button4" name="Button4" x="170" verticalCenter="0" width="30" height="25" skinClass="zszh_ToolsBar.Skin_ToolsBarBt" icon="{Button4_down}" buttonMode="true" />
	<s:Button id="Button5" name="Button5" x="220" verticalCenter="0" width="30" height="25" skinClass="zszh_ToolsBar.Skin_ToolsBarBt" icon="{Button5_down}" buttonMode="true" />
	
	<s:Button id="Button6" name="Button6" x="275" verticalCenter="0" width="30" height="25" skinClass="zszh_ToolsBar.Skin_ToolsBarBt" icon="{Button6_down}" click="ShowWorkspace2D(event)" buttonMode="true" />
	<s:Button id="Button7" name="Button7" x="315" verticalCenter="0" width="30" height="25" skinClass="zszh_ToolsBar.Skin_ToolsBarBt" icon="{Button7_down}" click="ShowWorkspace3D(event)" buttonMode="true" />

	<s:Button id="Button8" name="Button8" x="380" verticalCenter="0" width="25" height="25" skinClass="zszh_ToolsBar.Skin_ToolsBarBt" icon="{Button8_down}" buttonMode="true" />
	<s:Button id="Button9" name="Button9" x="495" verticalCenter="0" width="25" height="25" skinClass="zszh_ToolsBar.Skin_ToolsBarBt" icon="{Button9_down}" buttonMode="true" />
	
	<s:Button id="Button10" name="Button10" x="545" verticalCenter="0" width="25" height="25" skinClass="zszh_ToolsBar.Skin_ToolsBarBt" icon="{Button10_down}" click="ShowCenter(event)" buttonMode="true" />
	<s:Button id="Button11" name="Button11" x="585" verticalCenter="0" width="25" height="25" skinClass="zszh_ToolsBar.Skin_ToolsBarBt" icon="{Button11_down}" buttonMode="true" />


</s:SkinnableContainer>